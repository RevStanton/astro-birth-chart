<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Natal Chart — Free Astrology</title>
  <link rel="stylesheet" href="./styles.css"/>
  <!-- moment + timezone for DST-aware offsets -->
  <script src="https://cdn.jsdelivr.net/npm/moment@2/moment.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/moment-timezone/builds/moment-timezone-with-data.min.js"></script>
</head>
<body>
  <nav class="topnav">
  <div class="nav-inner">
    <a href="./index.html" class="brand">Astro</a>
    <ul class="menu">
      <li><a href="./index.html" class="nav-link">Chart</a></li>
      <li><a href="./learn.html" class="nav-link">Learn</a></li>
    </ul>
  </div>
</nav>


  <main class="container">
    <header class="page-header">
      <h1>Natal Chart</h1>
      <p class="sub">Lite mode: one API call for planets; houses & aspects computed locally.</p>
    </header>

    <form id="natal-form" class="card">
      <div class="grid grid-3">
        <label> Date
          <input type="date" name="date_iso" required />
        </label>
        <label> Time (24h)
          <input type="time" name="time_hm" step="60" required />
        </label>
        <label> Seconds
          <input type="number" name="seconds" min="0" max="59" value="0" required />
        </label>

        <!-- Location with autocomplete -->
        <label class="col-span-2"> Location (city, state or ZIP)
          <input type="text" name="location_query" id="location-input" autocomplete="off" placeholder="e.g., Newark, DE or 19711" />
          <div id="location-suggestions" class="suggestions hidden" role="listbox" aria-label="Location suggestions"></div>
        </label>
        <label class="align-end">
          <button type="button" id="btn-lookup" class="btn btn-ghost">Lookup</button>
        </label>

        <label> Latitude (N+, S-)
          <input type="number" step="0.0001" name="latitude" placeholder="39.6837" required />
        </label>
        <label> Longitude (E+, W-)
          <input type="number" step="0.0001" name="longitude" placeholder="-75.7497" required />
        </label>
        <label> Time zone (auto)
          <input type="text" id="timezone_label" name="timezone_label" placeholder="America/New_York (UTC-4)" readonly />
        </label>
        <input type="hidden" id="timezone" name="timezone" required />
      </div>

      <div id="lookup-note" class="lookup-note" aria-live="polite"></div>

      <details class="advanced">
        <summary>Advanced (optional) — filters & colors</summary>
        <div class="grid grid-3">
          <label> Observation Point
            <select name="observation_point">
              <option value="topocentric" selected>topocentric</option>
              <option value="geocentric">geocentric</option>
            </select>
          </label>
          <label> Ayanamsha
            <select name="ayanamsha">
              <option value="tropical" selected>tropical</option>
              <option value="sayana">sayana</option>
              <option value="lahiri">lahiri</option>
            </select>
          </label>
          <label> Language
            <select name="language">
              <option value="en" selected>en</option>
              <option value="es">es</option><option value="fr">fr</option><option value="pt">pt</option>
              <option value="ru">ru</option><option value="de">de</option><option value="ja">ja</option>
              <option value="pl">pl</option><option value="tr">tr</option>
            </select>
          </label>

          <label>Exclude Planets (CSV)
            <input type="text" name="exclude_planets" placeholder='Lilith,Chiron'/>
          </label>
          <label>Allowed Aspects (CSV)
            <input type="text" name="allowed_aspects" placeholder='Conjunction,Trine'/>
          </label>
          <label>Orb Values (JSON)
            <textarea name="orb_values" rows="3" placeholder='{"Conjunction":3,"Opposition":5,"Square":5,"Trine":5}'></textarea>
          </label>
        </div>
      </details>

      <!-- Action bar -->
      <div class="action-bar">
        <div class="toggles">
          <label class="switch">
            <input type="checkbox" name="lite_mode" checked />
            <span>Lite mode</span>
          </label>
          <label class="switch">
            <input type="checkbox" id="show-minor-aspects" />
            <span>Show minor aspects</span>
          </label>
          <label class="switch">
            <input type="checkbox" id="show-asteroids" checked />
            <span>Show asteroids/points</span>
          </label>
        </div>
        <button type="submit" class="btn btn-primary">Generate</button>
      </div>
    </form>

    <!-- ================== CHART ================== -->
    <section class="card chart-wrap">
      <!-- your canvas stays the same ID -->
      <canvas id="wheel" width="900" height="900" aria-label="Natal wheel"></canvas>

      <!-- legend now overlays the chart container -->
      <aside id="legend" class="legend legend-overlay" aria-label="Aspects legend">
        <h4>Aspects</h4>
        <ul>
          <li><span class="swatch conj"></span> Conjunction</li>
          <li><span class="swatch trine"></span> Trine</li>
          <li><span class="swatch square"></span> Square</li>
          <li><span class="swatch sextile"></span> Sextile</li>
          <li><span class="swatch opp"></span> Opposition</li>
        </ul>
      </aside>
    </section>

    <!-- ================== PERSONAL INSIGHTS ================== -->
    <section class="card insights-wide">
      <div class="insights-bar">
        <h3>Personal Insights</h3>
        <div class="bar-actions">
          <button id="btn-insights" class="btn">Generate Insights</button>
          <button id="btn-report" class="btn btn-ghost" disabled>Download PDF Report</button>
        </div>
      </div>
      <div id="insights-output" class="insights-output" aria-live="polite"></div>
    </section>

    <!-- ================== DETAILS (PLANETS / HOUSES / ASPECTS) ================== -->
    <section class="details-grid">
      <div class="card detail-card">
        <h4>Planets</h4>
        <div class="table-scroll">
          <table id="planets-table" class="slim-table"></table>
        </div>
      </div>

      <div class="card detail-card">
        <h4>Houses (Whole Sign)</h4>
        <div class="table-scroll">
          <table id="houses-table" class="slim-table"></table>
        </div>
      </div>

      <div class="card detail-card">
        <h4>Aspects (Local)</h4>
        <div class="table-scroll">
          <table id="aspects-table" class="slim-table"></table>
        </div>
      </div>
    </section>


      <!-- jsPDF + AutoTable (CDN) -->
      <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.8.3/dist/jspdf.plugin.autotable.min.js"></script>

      <!-- Your modules -->
      <script type="module" src="./app.js"></script>
      <script type="module" src="./report.js"></script>

    <!-- Data widgets -->
    <section id="results" class="widgets hidden">
      <div class="card">
        <div class="card-header">Planets</div>
        <div class="table-wrap"><table id="planets-table"></table></div>
      </div>

      <div class="card">
        <div class="card-header">Houses (Whole Sign)</div>
        <div class="table-wrap"><table id="houses-table"></table></div>
      </div>

      <div class="card">
        <div class="card-header">Aspects (Local)</div>
        <div class="table-wrap"><table id="aspects-table"></table></div>
      </div>
    </section>



  <script type="module" src="./app.js"></script>
</body>
</html>
